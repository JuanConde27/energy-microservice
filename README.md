# **Energy Microservice**

This is a **Golang-based microservice** for managing and retrieving energy consumption data. It allows querying consumption data by **daily, weekly, or monthly periods**.

## **Project Structure**

```
energy-microservice/
â”‚â”€â”€ src/
â”‚   â”œâ”€â”€ config/                  # Database and server configuration
â”‚   â”‚   â”œâ”€â”€ connection.go
â”‚   â”‚   â”œâ”€â”€ handler.go
â”‚   â”œâ”€â”€ controllers/             # Controller handling request logic
â”‚   â”‚   â”œâ”€â”€ consumption.controller.go
â”‚   â”œâ”€â”€ middlewares/             # Middleware functions
â”‚   â”‚   â”œâ”€â”€ recovery.middleware.go
â”‚   â”œâ”€â”€ models/                  # Data models
â”‚   â”‚   â”œâ”€â”€ consumption.model.go
â”‚   â”œâ”€â”€ repositories/            # Database queries
â”‚   â”‚   â”œâ”€â”€ consumption_repository.go
â”‚   â”œâ”€â”€ routes/                  # API route definitions
â”‚   â”‚   â”œâ”€â”€ consumption.routes.go
â”‚   â”œâ”€â”€ server/                  # Server setup and middleware
â”‚   â”‚   â”œâ”€â”€ middlewares.go
â”‚   â”‚   â”œâ”€â”€ routes.go
â”‚   â”‚   â”œâ”€â”€ server.go
â”‚   â”œâ”€â”€ services/                # Business logic
â”‚   â”‚   â”œâ”€â”€ consumption.service.go
â”‚   â”œâ”€â”€ test/                    # Unit tests
â”‚   â”‚   â”œâ”€â”€ consumption_repository_test.go
â”‚   â”‚   â”œâ”€â”€ consumption_service_test.go
â”‚   â”œâ”€â”€ utils/                   # Utility functions
â”‚   â”‚   â”œâ”€â”€ loadCSVData.go
â”œâ”€â”€ tmp/                         # Temporary storage (if needed)
â”œâ”€â”€ .air.toml                    # Configuration for Air (if using live reload)
â”œâ”€â”€ .env                         # Environment variables (ignored in Git)
â”œâ”€â”€ .gitignore                   # Git ignored files
â”œâ”€â”€ go.mod                        # Go modules dependencies
â”œâ”€â”€ go.sum                        # Checksums for dependencies
â”œâ”€â”€ main.go                       # Entry point
â”œâ”€â”€ README.md                     # Project documentation
```

## **Prerequisites**

- Install **Go** (â‰¥1.18)
- Install **PostgreSQL**
- Install **Gorilla Mux** (for routing)
- Install **GORM** (for database handling)
- Install **Testify** and **SQLMock** (for unit tests)

## **Installation**

Clone the repository and install dependencies:

```sh
git clone https://github.com/JuanConde27/energy-microservice.git
cd energy-microservice
go mod tidy
```

## **Setting Up the Database**

Update your **PostgreSQL** connection details in `.env`:

```sh
DATABASE_URL=YOUR_DATABASE_URL_HERE
```

## **Running the Microservice**

Start the service:

```sh
go run main.go
```

The server will start at `http://localhost:3000`.

## **CSV File Loading**

To load data from a CSV file, place the file in the project root and specify its path in `src/server/server.go`:

```go
csvPath := "test_bia.csv"
```

## **Usage**

### **Energy Consumption Endpoint**

#### **GET `/consumption`**

This endpoint retrieves energy consumption data based on parameters.

### **Query Parameters**

| Parameter      | Type     | Required | Description |
|---------------|---------|----------|-------------|
| `meters_ids`  | string  | âœ… Yes  | Comma-separated list of meter IDs (e.g., `1,2,3`) |
| `start_date`  | string  | âœ… Yes  | Start date in **YYYY-MM-DD** format |
| `end_date`    | string  | âœ… Yes  | End date in **YYYY-MM-DD** format |
| `kind_period` | string  | âœ… Yes  | `daily`, `weekly`, or `monthly` |

### **Examples**

#### **Daily Consumption**

```sh
curl "http://localhost:3000/consumption?meters_ids=1&start_date=2023-06-01&end_date=2023-06-10&kind_period=daily"
```

#### **Monthly Consumption**

```sh
curl "http://localhost:3000/consumption?meters_ids=1&start_date=2023-06-01&end_date=2023-07-10&kind_period=monthly"
```

#### **Weekly Consumption (Multiple Meters)**

```sh
curl "http://localhost:3000/consumption?meters_ids=1,2,3&start_date=2023-06-01&end_date=2023-06-26&kind_period=weekly"
```

### **How to Modify Query Parameters**

1. **Change meter IDs:** Update `meters_ids=1,2,3` with the desired meter IDs.
2. **Change date range:** Modify `start_date` and `end_date` (format: YYYY-MM-DD).
3. **Change period type:** Use `kind_period=daily`, `kind_period=weekly`, or `kind_period=monthly`.

## **Running Unit Tests**

Run all tests with:

```sh
go test -v ./src/test
```

Example output:

```
=== RUN   TestGetConsumptionByPeriod
âœ… Passed: Daily consumption retrieval
--- PASS: TestGetConsumptionByPeriod (0.00s)
PASS
```

## **Git Flow Workflow**

### **Start a New Feature**

```sh
git flow feature start feature-name
```

### **Push the Feature Branch**

```sh
git push --set-upstream origin feature/feature-name
```

### **Finish a Feature**

```sh
git flow feature finish feature-name
git push origin develop
```

---

This **README** provides all necessary details for setting up and running the **Energy Microservice**. Let me know if you need any modifications! ðŸš€

